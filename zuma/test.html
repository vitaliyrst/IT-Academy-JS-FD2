<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test1</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<canvas id="canvas" width="1200" height="800"></canvas>
<script>
        document.addEventListener('click', (eo) => {
           console.log(eo.clientX, eo.clientY)
       });

    let canvas = document.getElementById('canvas');
    let context = canvas.getContext('2d');
    let img = new Image();
    img.src = './storage/1-1.jpg';
    context.drawImage(img, 0,0, 1200, 800);
    let bezierArr = [];
    obj = [
        {A: {x: 250, y: -30}, B: {x: 40, y: 152}, C: {x: 20, y: 318}, D: {x: 92, y: 515}},
        {A: {x: 92, y: 515}, B: {x: 145, y: 630}, C: {x: 250, y: 750}, D: {x: 416, y: 755}},
        {A: {x: 416, y: 755}, B: {x: 539, y: 760}, C: {x: 721, y: 780}, D: {x: 893, y: 691}},
        {A: {x: 893, y: 691}, B: {x: 970, y: 652}, C: {x: 1030, y: 551}, D: {x: 1035, y: 469}},
        {A: {x: 1035, y: 469}, B: {x: 1050, y: 370}, C: {x: 1023, y: 247}, D: {x: 1013, y: 193}},
        {A: {x: 1013, y: 193}, B: {x: 970, y: 60}, C: {x: 920, y: 50}, D: {x: 870, y: 120}},
        {A: {x: 870, y: 120}, B: {x: 845, y: 160}, C: {x: 905, y: 252}, D: {x: 913, y: 344}},
        {A: {x: 913, y: 344}, B: {x: 930, y: 431}, C: {x: 880, y: 550}, D: {x: 813, y: 593}},
        {A: {x: 813, y: 593}, B: {x: 730, y: 660}, C: {x: 640, y: 640}, D: {x: 682, y: 540}},
        {A: {x: 682, y: 540}, B: {x: 750, y: 506}, C: {x: 800, y: 436}, D: {x: 797, y: 362}},
        {A: {x: 797, y: 362}, B: {x: 800, y: 200}, C: {x: 701, y: 150}, D: {x: 601, y: 136}},
        {A: {x: 601, y: 136}, B: {x: 468, y: 120}, C: {x: 363, y: 170}, D: {x: 327, y: 261}},
        {A: {x: 327, y: 261}, B: {x: 300, y: 336}, C: {x: 290, y: 413}, D: {x: 370, y: 491}},
        {A: {x: 370, y: 491}, B: {x: 460, y: 549}, C: {x: 418, y: 630}, D: {x: 392, y: 628}},
        {A: {x: 392, y: 628}, B: {x: 318, y: 650}, C: {x: 230, y: 552}, D: {x: 206, y: 494}},
        {A: {x: 206, y: 494}, B: {x: 140, y: 366}, C: {x: 160, y: 241}, D: {x: 253, y: 146}},
        /*{p0: {x: 653, y: 300}, p1: {x: 635, y: 420}, p2: {x: 588, y: 495}, p3: {x: 460, y: 545}},
        {p0: {x: 460, y: 545}, p1: {x: 310, y: 590}, p2: {x: 135, y: 490}, p3: {x: 136, y: 290}},
        {p0: {x: 136, y: 290}, p1: {x: 175, y: 0}, p2: {x: 518, y: 0}, p3: {x: 585, y: 230}},
        {p0: {x: 585, y: 230}, p1: {x: 630, y: 400}, p2: {x: 450, y: 560}, p3: {x: 303, y: 475}},
        {p0: {x: 303, y: 475}, p1: {x: 115, y: 369}, p2: {x: 205, y: 115}, p3: {x: 386, y: 130}},*/
        /*{p0: {x: 386, y: 130}, p1: {x: 590, y: 175}, p2: {x: 565, y: 415}, p3: {x: 386, y: 432}},
        {p0: {x: 386, y: 432}, p1: {x: 300, y: 430}, p2: {x: 240, y: 350}, p3: {x: 269, y: 250}}*/
    ];

    function getBezier(p0, p1, p2, p3) {

        function bezier(t) {
            let cX = 3 * (p1.x - p0.x);
            let bX = 3 * (p2.x - p1.x) - cX;
            let aX = p3.x - p0.x - cX - bX;

            let cY = 3 * (p1.y - p0.y);
            let bY = 3 * (p2.y - p1.y) - cY;
            let aY = p3.y - p0.y - cY - bY;

            let x = (aX * Math.pow(t, 3)) + (bX * Math.pow(t, 2)) + (cX * t) + p0.x;
            let y = (aY * Math.pow(t, 3)) + (bY * Math.pow(t, 2)) + (cY * t) + p0.y;
            return {x: x, y: y};
        }

        let accuracy = 0.015;
        let count = 0;
        if (count === 0) {
            context.moveTo(p0.x, p0.y);
            count++;
        }

        for (let i = 0; i < 1; i += accuracy) {
            let data = bezier(i);
            context.lineTo(data.x, data.y);
            context.strokeStyle = 'yellow';
            context.stroke();
            bezierArr.push({x: data.x, y: data.y});
        }
    }

    for (let i = 0; i < obj.length; i++) {
        getBezier(obj[i].A, obj[i].B, obj[i].C, obj[i].D);
    }


    class Ball {
        constructor(x, y, context, path) {
            this.x = x;
            this.y = y;
            this.context = context;
            this.path = path;
            this.radius = 15;
            this.speed = 2;
            this.color = 'red';
            this.run = 0;

        }

        draw() {
            this.context.fillStyle = this.color;
            this.context.beginPath();
            this.context.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            this.context.closePath();
            this.context.fill();
        }

        update() {
            if (this.path.length < 2)
                return;
            if (this.run >= this.path.length)
                this.run = 0;
            if (this.run === 0) {
                this.x = this.path[0].x;
                this.y = this.path[0].y;
                this.run++;
            } else {
                let angle = Math.atan2(this.path[this.run].x - this.x, this.path[this.run].y - this.y);

                if (Math.abs(this.x - this.path[this.run].x) < this.speed &&
                    Math.abs(this.y - this.path[this.run].y) < this.speed) {
                    this.x = this.path[this.run].x;
                    this.y = this.path[this.run].y;
                    this.run++;
                } else {
                    this.x += Math.sin(angle) * this.speed;
                    this.y += Math.cos(angle) * this.speed;
                }
            }
        }
    }

    let ball = new Ball(bezierArr[0][0], bezierArr[0][1], context, bezierArr);

    function update() {
        context.fillStyle = "#EEE";
        context.fillRect(0, 0, 800, 800);
        if (bezierArr.length > 1) {
            context.strokeStyle = "#444";
            context.beginPath();
            context.moveTo(bezierArr[0].x, bezierArr[0].y);
            for (let i = 1; i < bezierArr.length; i++)
                context.lineTo(bezierArr[i].x, bezierArr[i].y);
            context.stroke();
            context.closePath();
        }
        ball.draw();
        ball.update();
        window.requestAnimationFrame(update);
    }


</script>
</body>
</html>